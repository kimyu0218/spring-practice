# external properties

[docs.spring.io environment-abstraction](https://docs.spring.io/spring-framework/reference/core/beans/environment.html)

## `Environment` bean

ì• í”Œë¦¬ì¼€ì´ì…˜ í™˜ê²½â€¢í”„ë¡œíŒŒì¼â€¢ì†ì„±ì„ ìº¡ìŠí™”í•œ ì¸í„°í˜ì´ìŠ¤
- í”„ë¡œíŒŒì¼ ê´€ë¦¬ + ì†ì„± ì¡°íšŒ
- Spring IoC container ì´ˆê¸°í™” ì‹œ, ì• í”Œë¦¬ì¼€ì´ì…˜ í™˜ê²½ ì„¤ì •ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `Environment` bean ìë™ ìƒì„±
  - `Environment` : Spring Coreì˜ ì¼ë¶€
    - `PropertySources` â†’ `application.properties`, í™˜ê²½ ë³€ìˆ˜, ì‹œìŠ¤í…œ ì†ì„± ê°’ ì½ì–´ì˜´

> `@PropertySource`
>- í´ë˜ìŠ¤ ë ˆë²¨ ì–´ë…¸í…Œì´ì…˜ (ì£¼ë¡œ configurationì—ì„œ ì‚¬ìš©)
>- ì™¸ë¶€ ì†ì„± íŒŒì¼ ë¡œë“œ
>- classpathâ€¢file ê²½ë¡œ ì§€ì • ê°€ëŠ¥
>- ë³„ë„ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´, `src/main/resources/application.properties`

```java
@Bean
public DataSource dataSource(Environment env) {
  ...
  ds.setDriverClassName(env.getProperty("db.driver"));
  ds.setUrl(env.getProperty("db.url"));
  ds.setUser(env.getProperty("db.user"));
  ds.setPassword(env.getProperty("db.password"));
  return ds;
}
```

```properties
db.driver=[DB_DRIVER]
db.url=[DB_URL]
db.user=[DB_USER]
db.password=[DB_PASSWORD]
```

## `@Profile`

- íŠ¹ì • ì¡°ê±´(= íŠ¹ì • í”„ë¡œíŒŒì¼ì´ í™œì„±í™”ëœ ê²½ìš°)ì—ì„œë§Œ bean ë“±ë¡
- ì„¤ì • ë¶„ë¦¬ â†’ dev/test/prod ë¶„ë¦¬ ê°€ëŠ¥
  - configurationâ€¢ë©”ì†Œë“œ ì• ëª¨ë‘ ê°€ëŠ¥

```java
@Configuration
@Profile("dev")
public class DevConfig { ... }
```

> ğŸ¤” Springì€ í”„ë¡œíŒŒì¼ í™œì„±í™” ì—¬ë¶€ë¥¼ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œ?
>
> 1. `application.properties`ì—ì„œ ì„¤ì •
> ```properties
> spring.profiles.active=dev
> ```
> 2. ëª…ë ¹ì¤„ ì¸ìˆ˜ë¡œ ì„¤ì •
> ```shell
> ./gradlew build
> java -jar buidl/libs/[APP].jar --spring.profiles.active=dev
> ```
 
> ğŸš¨ IntelliJëŠ” `run` ë²„íŠ¼ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ë•Œ, ë³„ë„ì˜ í”„ë¡œíŒŒì¼ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ `application.properties`ë¥¼ ì½ì–´ì˜¨ë‹¤. íŠ¹ì • í”„ë¡œíŒŒì¼ì„ ì§€ì •í•˜ê³  ì‹¶ë‹¤ë©´ `Run > Edit Configurations > Run/Debug Configurations`ë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤.

## `PropertySource`
ì™¸ë¶€ ì†ì„± íŒŒì¼ ì§€ì •
```java
@Configuration
@PropertySource("dev.properties")
public class DevConfig { ... }
```

## SpEL; Spring expression language

[docs.spring.io spring-expression-language](https://docs.spring.io/spring-framework/reference/core/expressions.html)
- ë¦¬í„°ëŸ´ í‘œí˜„
- ê°ì²´ì˜ í”„ë¡œí¼í‹° ì ‘ê·¼ ë° ë©”ì†Œë“œ í˜¸ì¶œ
- ì—°ì‚° ë° ì¡°ê±´ì‹
- ë¹ˆ ì°¸ì¡° ë“±

`@Value("#{environment['[PROPERTY]']}")` == `@Value("${[PROPERTY]}")`
- ì „ì : Springì˜ `Environment` ê°ì²´ë¡œë¶€í„° ì¡°íšŒ
- í›„ì : Springì˜ í”„ë¡œí¼í‹° íŒŒì¼ë¡œë¶€í„° ì¡°íšŒ