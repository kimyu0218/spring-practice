# Spring configuration style

![how spring DI container works](./images/02-1.png)

- configuration metadata
    - `BeanDefinition` (íƒ€ì…, ì´ë¦„, ìŠ¤ì½”í”„ ë“±)
      - bean ì´ë¦„ ê¸°ë³¸ê°’ = ë©”ì†Œë“œ ì´ë¦„
      - `@Bean(name="[NAME]")`ìœ¼ë¡œ ì§ì ‘ ë¶€ì—¬ ê°€ëŠ¥
    - ì˜ì¡´ì„± ì„¤ì • : í•´ë‹¹ beanì´ ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ bean

## Java-based configuration

`@Bean`ì´ ë¶™ì€ ë©”ì†Œë“œë¥¼ í¬í•¨í•˜ëŠ” `@Configuration` í´ë˜ìŠ¤

```java

@Configuration
public class ApplicationConfig {

  @Bean
  public MemberService memberService() {
    return new MemberServiceImpl(memberRepository());
  }

  @Bean
  public MemberRepository memberRepository() {
    return new JdbcMemberRepository(dataSource());
  }

  @Bean
  public DataSource dataSource() {
    ...
    return dataSource;
  }
}
```

> ğŸ˜ Spring Bootì˜ `application.properties`ë¥¼ ì‘ì„±í•˜ë©´ `DataSource` beanì„ ìë™ìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆë‹¤!

### `application.properties`

Spring Bootì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” íŒŒì¼

- auto configuration
    - ex. `DataSource` bean ìë™ ë“±ë¡
        - Spring Bootì˜ `DataSourceAutoConfiguration` í´ë˜ìŠ¤ì˜ ì§€ì›
            - `@ConditionOnProperty` ì–´ë…¸í…Œì´ì…˜ : property ê°’ì— ë”°ë¥¸ bean ìƒì„±
                - `@ConditionalOnProperty(prefix = "spring.datasource", name = "url")`
                - `spring.datasource` prefix ì¡´ì¬ â†’ `DataSource` bean ìƒì„±


### application context from multiple configurations

`@Import`ë¥¼ í†µí•´ ë‹¤ë¥¸ configuration í¬í•¨

```java
@Configuration
@Import(ApplicationConfig.class)
public class InfrastructureConfig { ... }
```

### 

<br />

# application context

[docs.spring.io spring IoC container](https://docs.spring.io/spring-framework/reference/core/beans/introduction.html)

- Spring IoC container : beanì˜ ìƒì„± ë° ê´€ë¦¬ ë‹´ë‹¹ ì»¨í…Œì´ë„ˆ
  - ex. `BeanFactory`, `ApplicationContext`
- `ApplicationContext` = `BeanFactory` ëª¨ë“  ê¸°ëŠ¥ + ë¶€ê°€ ê¸°ëŠ¥
    - ë¶€ê°€ ê¸°ëŠ¥ : `MessageSource`, `ApplicationEventPublisher` ë“±

(Spring ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ : `ApplicationContext context = SpringApplication.run(ApplicationConfig.class);`)

1. bean ì¡°íšŒ : bean ì´ë¦„â€¢íƒ€ì…ì„ í†µí•´ bean ì •ì˜ ì¡°íšŒ
    - ex. `context.getBean("MemberService", MemberService.class)`
2. bean ìƒì„± ì—¬ë¶€ í™•ì¸
    - ì‹±ê¸€í†¤ì˜ ê²½ìš°, ìš”ì²­ëœ beanì´ ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. bean ì¸ìŠ¤í„´ìŠ¤í™”
4. beanì— í•„ìš”í•œ ì˜ì¡´ì„± ì£¼ì…
5. bean ì´ˆê¸°í™”
6. bean ë°˜í™˜

> bean ì¡°íšŒ ë°©ë²•
>1. ì•„ì´ë””ë¡œ ì¡°íšŒ
>2. íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ
>3. ì•„ì´ë””ì™€ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ

<br />

# Bean ìŠ¤ì½”í”„
1. singleton : (ê¸°ë³¸ê°’) `@Bean` == `@Bean @Scope("singleton")`
2. prototype : `@Scope("prototype")`
3. session : (web only) `@Scope("session")` 
4. request : (web only) `@Scope("request")`