# Spring Boot Test

### test dependencies in spring-boot-starter-test

#### JUnit

Java ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

- `@Test` : í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œ ì •ì˜
- `@BeforeEach`, `@AfterEach` : í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „/í›„ì— ì‹¤í–‰ë  ë©”ì†Œë“œ ì •ì˜
- `@BeforeAll`, `@AfterAll` : ëª¨ë“  í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œ ì‹¤í–‰ ì „/í›„ì— ì‹¤í–‰ë  ë©”ì†Œë“œ ì •ì˜

#### Spring Test & Spring Boot Test

ì• í”Œë¦¬ì¼€ì´ì…˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `@SpringBootTest` : ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ë¡œë“œ ë° í…ŒìŠ¤íŠ¸
- `@WebMvcTest` : Spring MVC ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸
- `@TestConfiguration` : í…ŒìŠ¤íŠ¸ ì „ìš© ì„¤ì • í´ë˜ìŠ¤ ì •ì˜ 

#### AssertJ 

í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì§ê´€ì ì¸ ë‹¨ì–¸ë¬¸ì„ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

- `assertThat([ACTUAL]).isEqualTo([EXPECTED])`

#### Mockito

ëª© ê°ì²´ë¥¼ ìƒì„±â€¢ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

- `@Mock` : ëª© ê°ì²´ ìƒì„±
- `@InjectMocks` : ëª© ê°ì²´ë¥¼ ì£¼ì…í•˜ëŠ” ê°ì²´ ìƒì„± ë° ì´ˆê¸°í™”

### `@SpringBootTest`

Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì–´ë…¸í…Œì´ì…˜

- ìë™ìœ¼ë¡œ `@SpringBootConfiguration` ê²€ìƒ‰
  - `@ContextConfiguration` ëŒ€ì²´ ê°€ëŠ¥
    - í†µí•© í…ŒìŠ¤íŠ¸ â†’ `@SpringBootTest`
    - íŠ¹ì • ë ˆì´ì–´ í…ŒìŠ¤íŠ¸ â†’ `@ContextConfiguration`
- ë‹¤ì–‘í•œ `webEnvironment` ëª¨ë“œ ì§€ì›
  - `RANDOM_PORT` : ì„ì˜ì˜ í¬íŠ¸ë¡œ ë‚´ì¥ ì„œë²„ ì‹œì‘
  - `DEFINED_PORT` : ì§€ì •ëœ í¬íŠ¸ë¡œ ë‚´ì¥ ì„œë²„ ì‹œì‘
  - `MOCK` : ëª¨í‚¹ëœ servlet í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
  - `NONE` : ì›¹ í™˜ê²½ ì—†ì´ í…ŒìŠ¤íŠ¸
- `TestRestTemplate` ìë™ êµ¬ì„± â†’ RESTful API í…ŒìŠ¤íŠ¸ ìš©ì´
  - ì„œë²„ê°€ ì˜¤ë¥˜ ì‘ë‹µì„ ë°›ì„ ë•Œ ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•Šë„ë¡ í•¨
  - ì¿ í‚¤ì™€ ë¦¬ë‹¤ì´ë ‰ì…˜ì„ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •

### MockMVC test

ì»¨íŠ¸ë¡¤ëŸ¬ ë° ì‘ë‹µ ê²€ì¦

- `@SpringBootTest(webEnvironment = WebEnvironment.MOCK)`
  - ë‚´ì¥ëœ servlet container ëŒ€ì‹  mock servlet í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
  - ì‹¤ì œ ì„œë²„ë¥¼ êµ¬ë™í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- `@AutoConfigureMockMvc`
  - `MockMvc` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì„±í•˜ê³  í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— ì£¼ì…
  - `MockMvc`ë¥¼ í†µí•´ HTTP ìš”ì²­ ë° ì‘ë‹µ ê²€ì¦ ê°€ëŠ¥
  ```java
  @SpringBootTest(webEnvironment = WebEnvironment.MOCK)
  @AutoConfigureMockMvc
  public class MemberControllerTest {
    @Autowired
    MockMvc mockMvc;
    ...
  
    @Test
    public void testGet() {
      mockMvc.perform(get("/members"))
        .andExpect(status.isOk());
    } 
  }
  ```
- `MockMvc`
  - `perform([REQUEST_BUILDER])` : HTTP ìš”ì²­ ìˆ˜í–‰
    - `ResultActions` ê°ì²´ ë°˜í™˜ 
    - `MockMvcRequestBuilders` : ìš”ì²­ì„ ìƒì„±í•˜ëŠ” ë¹Œë” í´ë˜ìŠ¤
  - `andExpect([RESULT_MATCHER])` : HTTP ì‘ë‹µ ê²€ì¦
    - `MockMvcResultMatchers` : ì‘ë‹µì„ ê²€ì¦í•˜ëŠ” í´ë˜ìŠ¤ ì œê³µ
      - `status()` : ìƒíƒœ ì½”ë“œ ê²€ì¦
      - `content()` : ë³¸ë¬¸ ê²€ì¦
      - `header()` : í—¤ë” ê²€ì¦

### slice test

ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¹ì • ë¶€ë¶„(= ìŠ¬ë¼ì´ìŠ¤)ì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ == ì˜ì¡´ì„±ì€ ëª¨ë‘ ëª¨í‚¹ë˜ì–´ì•¼í•¨

- ì›¹ ìŠ¬ë¼ì´ìŠ¤
  - ì›¹ ê³„ì¸µ (ex. ì»¨íŠ¸ë¡¤ëŸ¬, í•„í„°)
  - `@WebMvcTest([CONTROLLER_CLASS])`
    - ì „ì²´ ìë™ ì„¤ì • ë¹„í™œì„±í™” â†’ MVC í…ŒìŠ¤íŠ¸ì— ê´€ë ¨ëœ ì„¤ì •ë§Œ ì ìš©
    - MVC í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ìë™ ì„¤ì •
      - `MockMvc` bean ìë™ ì„¤ì •
      - (ì„ íƒ) Spring Security ìë™ ì„¤ì •
    - ì£¼ë¡œ `@MockBean`ê³¼ í•¨ê»˜ ì‚¬ìš©
      - ì‹¤ì œ êµ¬í˜„ì²´ ëŒ€ì‹  ëª¨í‚¹ëœ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ â†’ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì˜ ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
  ```java
  @WebMvcTest(MemberController.class)
  public class MemberControllerTest {
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private MemberService memberService;
      
    @Test
    public void testGetMembers() {
      ...
      when(memberService.getAllMembers()).thenReturn(members);
        
      mockMvc.perform(get("/members"))
        .andExpect(status().isOk())
        .andExpect(jsonPath("$[0].name").value("Alice"))
        .andExpect(jsonPath("$[1].name").value("Bob")); 
    }
    ...
  }
  ```
  > `when`ì€ Jestì˜ `spyOn`ê³¼ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ í•œë‹¤.
  
  > ğŸ¤” `@Mock` vs. `@MockBean`
  > - `@Mock`
  >   - Mockito í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µ â†’ Spring ì»¨í…ìŠ¤íŠ¸ê°€ í•„ìš”í•˜ì§€ ì•Šì„ ë•Œ
  > - `@MockBean`
  >   - Spring Boot í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µ â†’ Spring ì»¨í…ìŠ¤íŠ¸ê°€ í•„ìš”í•  ë•Œ
  >   - Spring ì»¨í…ìŠ¤íŠ¸ì— ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì¡´ì¬í•˜ëŠ” ê¸°ì¡´ì˜ beanì„ ëŒ€ì²´í•˜ëŠ” ìƒˆë¡œìš´ ëª© bean ìƒì„±
- ë ˆí¬ì§€í† ë¦¬ ìŠ¬ë¼ì´ìŠ¤
  - ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ
  - `@DataJpaTest`
    - JPAì™€ ê´€ë ¨ëœ ì»´í¬ë„ŒíŠ¸ë§Œ ë¡œë“œ (ex. `@Repository` beans)
    - `TestEntityManager` ìë™ ì„¤ì •
      - JPA `EntityManager` ëŒ€ì²´
    - ì„ë² ë””ë“œ ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
      - `@AutoConfigureTestDatabase`ë¥¼ í†µí•´ ê¸°ì¡´ DataSource ì˜¤ë²„ë¼ì´ë“œ
  ```java
  @DataJpaTest
  public class MemberRepositoryTest {
    @Autowired
    private MemberRepository memberRepository;
    
    @Autowired
    private TestEntityManager entityManager;
    
    @Test
    public void testFindByName() {
      Member member = new Member("Alice");
      entityManager.persistAndFlush(member);
      
      Member found = memberRepository.findByName("Alice");
      assertEquals(member.getName(), found.getName());
    }
    ...
  }
  ```


