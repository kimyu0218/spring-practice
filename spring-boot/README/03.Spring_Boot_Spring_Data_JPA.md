# Spring JPA

- Spring BootëŠ” JPAê°€ classpathì— ì¡´ì¬í•  ê²½ìš°, ëª‡ ê°€ì§€ beanì„ ìë™ìœ¼ë¡œ êµ¬ì„±í•œë‹¤.
  - `DataSource` : ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì— í•„ìš”í•œ ì •ë³´ (ex. JDBC url, username, password)
  - `EntityManagerFactoryBean` : `EntityManager`ë¥¼ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬
    - `EntityManager` : ì—”í‹°í‹°ì™€ ë°ì´í„°ë² ì´ìŠ¤ ê°„ ìƒí˜¸ì‘ìš© ë‹´ë‹¹
      - `@EnableAutoConfiguration`ì´ë‚˜ `@EntityScan`ì„ í†µí•´ ì—”í‹°í‹° ì°¾ìŒ
    - ê¸°ë³¸ JPA êµ¬í˜„ì²´ë¡œ Hibernate ì‚¬ìš©
  - `JpaTransactionManager` : íŠ¸ëœì­ì…˜ ê´€ë¦¬

<br />

# Spring Data JPA

- ë°ì´í„° ì ‘ê·¼ì„ ìœ„í•œ ë°˜ë³µì ì¸ ì½”ë“œ ì¤„ì„
  - ê°œë°œì : ì¸í„°í˜ì´ìŠ¤ ì •ì˜
  - Spring Data JPA : ì¸í„°í˜ì´ìŠ¤ ìë™ìœ¼ë¡œ êµ¬í˜„ (ex. ê¸°ë³¸ CRUD)
    - ë³µì¡í•œ ì¿¼ë¦¬ê°€ í•„ìš”í•œ ê²½ìš° `@Query` ì‚¬ìš©
    - í˜ì´ì§• ë° ì •ë ¬ ì§€ì›
  ```java
  public interface MemberRepository extends JpaRepository<Member, Long> { ... }
  ```
- RDBMS & NoSQL ì§€ì›
- low-levelì˜ ë°˜ë³µì ì¸ ì½”ë“œë¥¼ ìˆ¨ê¸°ê¸° ìœ„í•´ í…œí”Œë¦¿ í´ë˜ìŠ¤ ì œê³µ
  - `JdbcTemplate`
  - `MongoTemplate`

### how
1. ë„ë©”ì¸ í´ë˜ìŠ¤ ì •ì˜
```java
@Entity
public class Member {

  @Id
  @GeneratedValue(strategy=GenerationType.IDENTITY)
  private Long id;
  
  private String name;
  ...
}
```
- `@Entity` : JPA ì—”í‹°í‹° â†’ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘
  - ê¸°ë³¸ì ìœ¼ë¡œ ì—”í‹°í‹°ëª… = í…Œì´ë¸”ëª… 
  - `@Table` : ì—”í‹°í‹°ì™€ ë§¤í•‘ë  ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì§€ì •
- `@Id` : ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ (í•„ìˆ˜)
- `@GeneratedValue` : ê¸°ë³¸ í‚¤ ê°’ì˜ ìë™ ìƒì„± ë°©ì‹ ì„¤ì •
  - `GenerationType.AUTO` : JPAê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ì¶° ìë™ìœ¼ë¡œ ìƒì„± ì „ëµ ì„ íƒ
  - `GenerationType.IDENTITY` : auto increment ì‚¬ìš©

> ğŸ¤” í•„ë“œëª…ê³¼ ì»¬ëŸ¼ëª…, ì—”í‹°í‹°ëª…ê³¼ í…Œì´ë¸”ëª…ì´ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°
> 
> - `@Column`ê³¼ `@Table`ì„ ì´ìš©í•œ ëª…ì‹œì  ë§¤í•‘
> - `application.propeties`ì˜ `org.hibernate.boot.model.naming`ì—ì„œ ë„¤ì´ë° ì „ëµ ì§€ì •
>  - `PhysicalNamingStrategyStandardImpl` : (ë…¼ë¦¬) camelCase â†’ (ë¬¼ë¦¬) snake_case

> ğŸ’¡ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì§€ì›
> - `@Document` - MongoDB
> - `@Region` - Gemfire
> - `@NodeEntity` - Neo4J

2. ë ˆí¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
```java
public interface MemberRepository extends Repository<Member, Long> { ... }

public interface MemberCrudRepository extends CrudRepository<Member, Long> {
  /**
   * save, saveAll
   * findById, findAll, 
   * existsById
   * count
   * delete, deleteById, deleteAll
   */
}

public interface MemberPagingAndSortingRepository extends PagingAndSortingRepository<Member, Long> {
  /**
   * CrudRepositoryì˜ ëª¨ë“  ë©”ì†Œë“œ
   * findAll(Sort sort), findAll(Pageable pagable)
   */
}

public interface MemberJpaRepository extends JpaRepository<Member, Long> {
  /**
   * PagingAndSortingRepositoryì˜ ëª¨ë“  ë©”ì†Œë“œ
   * saveAllAndFlush
   * deleteInBatch, deleteAllInBatch
   */
}
```
- `Repository<T, ID>` : ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ ìµœìƒìœ„ ì¸í„°í˜ì´ìŠ¤
- `CrudRepository<T, ID>` : ê¸°ë³¸ì ì¸ CRUD ì œê³µ
  -  `Repository` ìƒì† ë°›ìŒ
  - ë‹¨ìˆœí•œ CRUD ì‘ì—… ì‹œ ì‚¬ìš© (ex. `save`, `findById`, `findAll`, `deleteById`)
- `PagingAndSortingRepository` : í˜ì´ì§• ë° ì •ë ¬ ê¸°ëŠ¥ ì œê³µ
  - `CrudRepository` ìƒì† ë°›ìŒ
  - ëŒ€ìš©ëŸ‰ ë°ì´í„° í˜ì´ì§• ì²˜ë¦¬â€¢ì •ë ¬ ì‹œ ì‚¬ìš©
- `JpaRepository` : JPAì™€ ê´€ë ¨ëœ ì¶”ê°€ ê¸°ëŠ¥ ì œê³µ
  - `PagingAndSortingRepository` ìƒì† ë°›ìŒ
  - ë°°ì¹˜ ì‚­ì œ, ë°°ì¹˜ ì €ì¥, í”ŒëŸ¬ì‹œ ë“± ì œê³µ

3. Spring Data JPAëŠ” ëŸ°íƒ€ì„ ì‹œ ë ˆí¬ì§€í† ë¦¬ë¥¼ êµ¬í˜„í•œë‹¤.

