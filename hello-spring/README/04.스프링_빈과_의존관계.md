# Background

## Spring Beans ğŸ«›

Spring IoC containerì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ê°ì²´

> Beanì€ ì£¼ë¡œ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì •ì˜ëœë‹¤. Spring IoC containerëŠ” ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ê³  ê´€ë¦¬í•œë‹¤.
>- `@Component` : ì¼ë°˜ Bean
>- `@Service` : ì„œë¹„ìŠ¤ Bean
>- `@Repository` : ë ˆí¬ì§€í† ë¦¬ Bean
>- `@Controller` : ì»¨íŠ¸ë¡¤ëŸ¬ Bean

### Spring IoC Container

Spring Bean(= ì• í”Œë¦¬ì¼€ì´ì…˜ ê°ì²´)ì„ ìƒì„±â€¢ì„¤ì •â€¢ê´€ë¦¬í•œë‹¤.

- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ í•„ìš”í•œ ê°ì²´ ìƒì„±
- ê°ì²´ ê°„ì˜ ì˜ì¡´ì„± ì„¤ì • ë° ì£¼ì…
- ê°ì²´ ìƒëª… ì£¼ê¸° ê´€ë¦¬ (from ìƒì„± to ì†Œë©¸)

#### IoC; inversion of control

ê°ì²´ì˜ ìƒì„±â€¢ê´€ë¦¬ â†’ ì½”ë“œê°€ ì•„ë‹Œ, ì™¸ë¶€ ì»¨í…Œì´ë„ˆë‚˜ í”„ë ˆì„ì›Œí¬ì— ë§¡ê¹€!

- ê°ì²´ì˜ ì œì–´ë¥¼ ì½”ë“œ ì™¸ë¶€ë¡œ ì´ë™
- ì˜ì¡´ì„± ì™¸ë¶€ì—ì„œ ì£¼ì… â†’ ë‚®ì€ ê²°í•©ë„ ğŸ‘
- êµ¬í˜„ì— ì¢…ì†ë˜ì§€ ì•ŠìŒ â†’ êµ¬í˜„ì²´ êµì²´â€¢í™•ì¥ ê°€ëŠ¥ â†’ ë†’ì€ ìœ ì—°ì„± ğŸ‘
    - êµ¬í˜„ ì¢…ì† â­• â†’ Aê°€ Bë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì•Œê³  ìˆë‹¤ â†’ êµì²´ ì‰½ì§€ ì•ŠìŒ
    - êµ¬í˜„ ì¢…ì† âŒ â†’ Aê°€ Bì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì•Œê³  ìˆë‹¤ â†’ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê°ì²´ë¡œ êµì²´ ê°€ëŠ¥

> IoCëŠ” DI (dependency injection) ë¥¼ í†µí•´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
>1. constructor ê¸°ë°˜ DI : ê°ì²´ ìƒì„± ì‹œ ëª¨ë“  ì˜ì¡´ì„± ì£¼ì… = ë¶ˆë³€ â†’ ê¶Œì¥í•˜ëŠ” ë°©ë²• ğŸ™†â€â™‚ï¸
>2. setter ê¸°ë°˜ DI
>3. field ê¸°ë°˜ DI : ì˜ì¡´ì„± ë³€ê²½ ê°€ëŠ¥ â†’ ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ë°©ë²• ğŸ™…â€â™‚ï¸

### Scope

Springì—ì„œ Beanì´ ìƒì„±ë˜ê³  ê´€ë¦¬ë˜ëŠ” ë²”ìœ„

- ì–¸ì œ ìƒì„±â€¢ì†Œë©¸ë˜ëŠ”ê°€
- ëª‡ ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”ê°€

[docs.spring.io bean-scopes](https://docs.spring.io/spring-framework/reference/core/beans/factory-scopes.html#beans-factory-scopes-websocket)

> Springì€ ê¸°ë³¸ì ìœ¼ë¡œ singleton ìŠ¤ì½”í”„ë¥¼ ì‚¬ìš©í•œë‹¤. ì¸ìŠ¤í„´ìŠ¤ëŠ” í•˜ë‚˜ë§Œ ìƒì„±ë˜ì–´ í•´ë‹¹ Beanì„ ìš”ì²­í•  ë•Œë§ˆë‹¤ ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¬ì‚¬ìš©ëœë‹¤.

| ìŠ¤ì½”í”„                 | ìƒì„±                        | ì†Œë©¸                        | ì—¬ëŸ¬ ê°œ ìƒì„± ê°€ëŠ¥ ì—¬ë¶€ |
|---------------------|---------------------------|---------------------------|---------------|
| singleton (default) | Spring IoC container ì‹œì‘ ì‹œ | Spring IoC container ì¢…ë£Œ ì‹œ | X             |
| prototype           | ìš”ì²­ ì‹œ                      | by ê°€ë¹„ì§€ì»¬ë ‰ì…˜                 | O             |
| request             | HTTP ìš”ì²­ ì‹œ                 | HTTP ìš”ì²­ ì¢…ë£Œ ì‹œ              | O             |
| session             | HTTP ì„¸ì…˜ ì‹œì‘ ì‹œ              | HTTP ì„¸ì…˜ ì¢…ë£Œ ì‹œ              | O             |
| application         | servlet context ì‹œì‘ ì‹œ      | servlet context ì¢…ë£Œ ì‹œ      | X             |
| websocket           | websocket ì„¸ì…˜ ì‹œì‘ ì‹œ         | websocket ì„¸ì…˜ ì¢…ë£Œ ì‹œ         | O             |

### How to register

#### 1. component scan (= ìë™!)

ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ìë™ ë“±ë¡

- Spring ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ë©´, Spring í”„ë ˆì„ì›Œí¬ëŠ” íŠ¹ì • íŒ¨í‚¤ì§€ ë‚´ì˜ í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìŠ¤ìº”í•˜ì—¬ Beanìœ¼ë¡œ ë“±ë¡í•œë‹¤.

> ğŸ¤” ê¸°ë³¸ basePackage
>- `@SpringBootApplication`ì€ ë‚´ë¶€ì ìœ¼ë¡œ `@ComponentScan`ì„ í¬í•¨í•œë‹¤.
>- ë³„ë„ë¡œ `@ComponentScan`ì„ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ í´ë˜ìŠ¤(= `main`ì´ ì†í•œ í´ë˜ìŠ¤)ê°€ ìœ„ì¹˜í•œ íŒ¨í‚¤ì§€ì˜ í•˜ìœ„ë¥¼ ìŠ¤ìº”í•œë‹¤.
>- ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¥¼ ìŠ¤ìº”í•˜ê³  ì‹¶ë‹¤ë©´, `@ComponetScan`ì„ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

> ğŸ¤” ì—¬ëŸ¬ ê°œì˜ Beanì´ ê°™ì€ íƒ€ì…ì„ ê°€ì§€ê³  ìˆë‹¤ë©´?
> ```text
> 1. MemberService í´ë˜ìŠ¤ëŠ” MemberRepository ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤.
> 2. MemberRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ AMemberRepositoryì™€ BMemberRepository í´ë˜ìŠ¤ê°€ ìˆë‹¤.
> 3. MemberService í´ë˜ìŠ¤ëŠ” @Autowiredë¥¼ ì´ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ëŠ”ë‹¤.
> ```
> `NoUniqueBeanDefinitionException` ë°œìƒ ğŸ
>
> í•´ê²° ë°©ë²•
>1. `@Primary` : ì—¬ëŸ¬ Bean ì¤‘ í•˜ë‚˜ë¥¼ ê¸°ë³¸ Beanìœ¼ë¡œ ì„¤ì •
>2. `@Qualifier("[BEAN]")` : íŠ¹ì • Beanì„ ëª…ì‹œì ìœ¼ë¡œ ì£¼ì…

#### 2. Java configuration (= ìˆ˜ë™!)

Java í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ì§ì ‘ ë“±ë¡

<br/>

# Spring Bean ì„¤ì •

## component scan

- `@Component` : Bean ë“±ë¡ì„ ìœ„í•´ í´ë˜ìŠ¤ì— ë¶™ì´ëŠ” ì–´ë…¸í…Œì´ì…˜
    - `@Component` ìë™ ë“±ë¡
    - `@Component`ë¥¼ í¬í•¨í•˜ëŠ” `@Controller` , `@Service`, `@Repository`ë„ ìë™ ë“±ë¡
- `@Autowired` :  ìë™ ì˜ì¡´ì„± ì£¼ì…
    - ìƒì„±ì/ë©”ì„œë“œ/í•„ë“œ ì•ì— ì‚¬ìš©
        - ë©”ì„œë“œì™€ í•„ë“œëŠ” ìˆœí™˜ ì˜ì¡´ì„± ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ ğŸ¤¯ â†’ ì»´íŒŒì¼ ì‹œì ì— í™•ì¸í•  ìˆ˜ ìˆëŠ” ìƒì„±ì DI ê¶Œì¥
    - ìƒì„±ìê°€ í•˜ë‚˜ì¸ ê²½ìš°, `@Autowired` ìƒëµ ê°€ëŠ¥

## java config

```java
package hello.hello_spring;

...

@Configuration
public class SpringConfig {

  @Bean
  public MemberService memberService() {
    return new MemberService(memberRepository());
  }

  @Bean
  public MemberRepository memberRepository() {
    return new MemoryMemberRepository();
  }
}
```

- `@Configuration` : Spring ì„¤ì • í´ë˜ìŠ¤ë¡œ ì§€ì •
    - Springì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” Bean ì •ì˜
- `@Bean` : ë©”ì†Œë“œê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ë¥¼ Beanìœ¼ë¡œ ë“±ë¡