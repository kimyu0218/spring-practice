# Background
## Spring Web MVC

servlet ê¸°ë°˜ ì›¹ í”„ë ˆì„ì›Œí¬
- Springì— ìˆëŠ” : `spring-webmvc`
- Web ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ”
- MVC íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ”
    - Model : ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„°
    - View : ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í™”ë©´ êµ¬ì„± (ex. í…œí”Œë¦¿ ì—”ì§„)
    - Controller : HTTP ìš”ì²­ ì²˜ë¦¬ `@RestController`

### servlet
[servlet](https://javaee.github.io/tutorial/servlets001.html#BNAFE) : HTTP ìš”ì²­ê³¼ ì‘ë‹µì„ ì²˜ë¦¬í•˜ëŠ” ì„œë²„ ì¸¡ ì»´í¬ë„ŒíŠ¸

#### servlet ë“±ì¥ ë°°ê²½
- ì´ˆì°½ê¸° ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ì •ì ì¸ ì½˜í…ì¸ ë§Œ ì œê³µí•  ìˆ˜ ìˆì—ˆë‹¤. 
  - `í´ë¼ì´ì–¸íŠ¸ â†” ì›¹ ì„œë²„`
  - ğŸ˜¥ ì‚¬ìš©ì ë§ì¶¤í˜• ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ì—†ë‹¤.
- ë™ì ì¸ ì½˜í…ì¸ ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ CGI(Common Gate Interface)ê°€ ë“±ì¥í–ˆë‹¤. 
  - `í´ë¼ì´ì–¸íŠ¸ â†” ì›¹ ì„œë²„ â†” CGI í”„ë¡œê·¸ë¨`
  - ì›¹ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ìš”ì²­ì„ CGI í”„ë¡œê·¸ë¨ì— ì „ë‹¬í•˜ê³ , CGI í”„ë¡œê·¸ë¨ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ë™ì ì¸ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ì—¬ ì›¹ ì„œë²„ë¡œ ì „ë‹¬í•œë‹¤.
  - ğŸ˜¥ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ ìƒì„± â†’ ìì› ì†Œëª¨ + (í”„ë¡œì„¸ìŠ¤ ìƒì„±â€¢ì¢…ë£Œë¡œ ì¸í•œ) ì„±ëŠ¥ ì €í•˜
- CGIì˜ í•œê³„ë¥¼ ê·¹ë³µí•œ servletì´ ë“±ì¥í–ˆë‹¤.
  - í”„ë¡œì„¸ìŠ¤ ëŒ€ì‹  ìŠ¤ë ˆë“œ ìƒì„± â†’ ìì› íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©

| static | dynamic with CGI | dynamic with servlet |
| --- | --- | --- |
| ![static](./images/02-1.png) | ![CGI](./images/02-2.png) | ![servlet](./images/02-3.png) |

#### ğŸ› ï¸ servlet ë™ì‘ ê³¼ì •
![servlet](./images/02-3.png)
```text
í´ë¼ì´ì–¸íŠ¸ â†” ì›¹ ì„œë²„ â†” servlet container
```
1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ì›¹ ì„œë²„(Tomcat)ë¡œ ì „ë‹¬ëœë‹¤.
2. ì›¹ ì„œë²„ëŠ” ìš”ì²­ì„ servlet containerë¡œ ì „ë‹¬í•œë‹¤.
3. servlet containerëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•  servletì„ ìƒì„±í•˜ê±°ë‚˜, ì´ë¯¸ ìƒì„±ëœ servletì„ ì‚¬ìš©í•œë‹¤.
4. servlet containerëŠ” ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³ , ìƒì„±ëœ ìŠ¤ë ˆë“œëŠ” servletì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‘ë‹µì„ ìƒì„±í•œë‹¤.
5. servlet containerëŠ” ì‘ë‹µì„ ì›¹ ì„œë²„ë¡œ ì „ë‹¬í•œë‹¤.
6. ì›¹ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µì„ ì „ë‹¬í•œë‹¤.

> servlet container
>- servlet ìƒëª… ì£¼ê¸° ê´€ë¦¬ : ìƒì„± / ì´ˆê¸°í™” `init()` / ì„œë¹„ìŠ¤ `service()` / ì†Œë©¸ `destroy()`
>  - servlet ì¬ì‚¬ìš© â†’ ë¹„ìš© ì ˆê° & ì„±ëŠ¥ í–¥ìƒ
>- ìŠ¤ë ˆë“œ ê´€ë¦¬

> servlet : servlet container = DB connection : DB connection pool 

### front controller pattern

ëª¨ë“  ìš”ì²­ì„ ë‹¨ì¼ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ëŠ” SW ë””ìì¸ íŒ¨í„´
- single entry point : ëª¨ë“  ìš”ì²­ì€ í•˜ë‚˜ì˜ front controllerë¥¼ í†µí•´ ë“¤ì–´ì˜¨ë‹¤.
- request dispatching : front controllerëŠ” ìš”ì²­(= URL)ì„ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬í•œë‹¤.
- common processing : ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ê¸° ì „ì— ê³µí†µì ìœ¼ë¡œ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. (ex. ì¸ì¦)

| servletì˜ í•œê³„ | front controller pattern | 
| --- | --- |
| ![servlet-limit](./images/02-4.png) | ![front-controller-pattern](./images/02-5.png) |

#### front controllerì˜ ì—…ë¬´
- í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ë¥¼ ì—°ê²°í•œë‹¤.
- ìš”ì²­ì— ë§ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§¤í•‘í•œë‹¤.
- ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì ì ˆí•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•œë‹¤.
- ì‘ë‹µì„ ìƒì„±í•˜ê³ , ë°˜í™˜í•œë‹¤.
```text
 controller ì‚¬ì „
      â†• (controller ì¡°íšŒ)
front controller â†” controller
      â†• (view ê²€ìƒ‰ & model ë°ì´í„° ì‘ì„±)
     view
```

### Spring Web MVC êµ¬ì¡°

front controller patternê³¼ ìœ ì‚¬í•œ êµ¬ì¡°ë¥¼ ê°–ëŠ”ë‹¤.

![spring-web-mvc](./images/02-6.png)

[docs.spring.io special-bean-types](https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-servlet/special-bean-types.html)
```text
  HandlerMapping
        â†• (controller ì¡°íšŒ)
DispatcherServlet â†” HandlerAdapter
        â†• (view ê²€ìƒ‰ & model ë°ì´í„° ë‹´ì•„ ì‘ë‹µ)
    ViewResolver
```
- `DispatcherServlet` : front controller ì—­í•  ìˆ˜í–‰ 
- `HandlerMapping` : ìš”ì²­ URLì„ ë°”íƒ•ìœ¼ë¡œ ì ì ˆí•œ ì»¨íŠ¸ë¡¤ëŸ¬(Handler)ì™€ ë§¤í•‘
- `HandlerAdapter` : DispatcherServletì´ ì°¾ì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ
  - í˜¸í™˜ì„± ì œê³µ â†’ ë‹¤ì–‘í•œ ìœ í˜•ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì§€ì›
    - `@RequestMapping` â†’ RequestMappingHandlerAdapter
    - `Controller` êµ¬í˜„ì²´ â†’ SimpleControllerHandlerAdapter
    - `HttpRequestHandler` êµ¬í˜„ì²´ â†’ HttpRequestHandlerAdapter
- `ViewResolver` : ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°˜í™˜í•œ view ì´ë¦„ì„ ì‹¤ì œ viewë¡œ ë³€í™˜

â†’ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

<br/>

# ì •ì  ì½˜í…ì¸ 
[docs.spring.io static-content](https://docs.spring.io/spring-boot/reference/web/servlet.html#web.servlet.spring-mvc.static-content)

Spring BootëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `/static`, `/public`, `/resource` ë””ë ‰í† ë¦¬ì—ì„œ ì •ì  ì½˜í…ì¸ ë¥¼ ì œê³µí•œë‹¤.

### How to serve

1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ì›¹ ì„œë²„ë¡œ ì „ë‹¬ëœë‹¤.
2. ì›¹ ì„œë²„ëŠ” `DispatcherServlet`ì— ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
`DispatcherServlet`ì€ ì •ì  ì½˜í…ì¸ ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ `ResourceHttpRequestHandler`ë¼ëŠ” íŠ¹ë³„í•œ í•¸ë“¤ëŸ¬ë¡œ ë¼ìš°íŒ…í•œë‹¤.
3. `ResourceHttpRequestHandler`ëŠ” ìš”ì²­ëœ URLì— í•´ë‹¹í•˜ëŠ” íŒŒì¼ì„ `/static` ë””ë ‰í† ë¦¬ì—ì„œ ì°¾ëŠ”ë‹¤.
4. `ResourceHttpRequestHandler`ëŠ” ì°¾ì€ ì •ì  ì½˜í…ì¸ ë¥¼ ê³§ë°”ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•œë‹¤.

> **ResourceHttpRequestHandlerë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ** <br>
> ì •ì  ë¦¬ì†ŒìŠ¤ ì§ì ‘ ì œê³µ â†’ ë¹ ë¡œê³  íš¨ìœ¨ì ì¸ ì‘ë‹µ
 
<br/>

# í…œí”Œë¦¿ ì—”ì§„

```java
@GetMapping("hello-template")
public String helloTemplate(@RequestParam("name") String name, Model model) {
    model.addAttribute("name", name);
    return "hello-template"; // view ì´ë¦„
}
```

### How to serve

1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ì›¹ ì„œë²„ë¡œ ì „ë‹¬ëœë‹¤.
2. ì›¹ ì„œë²„ëŠ” `DispatcherServlet`ì— ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
   `DispatcherServlet`ì€ ì ì ˆí•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ê¸° ìœ„í•´ `HandlerMapping`ì— ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
3. `HandlerMapping`ì€ ìš”ì²­ëœ URLì— ë§¤í•‘ëœ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ì•„ `DispatcherServlet`ì— ì „ë‹¬í•œë‹¤.
4. `DispatcherServlet`ì€ `HandlerAdapter`ë¥¼ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ê³  model ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ë‹¤.
5. `DispatcherServlet`ì€ `ViewResolver`ë¥¼ ì‚¬ìš©í•˜ì—¬ view ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” viewë¥¼ ì°¾ëŠ”ë‹¤.
6. `DispatcherServlet`ì€ model ë°ì´í„°ë¥¼ viewì— ë‹´ì•„ ìµœì¢… HTMLì„ ìƒì„±í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•œë‹¤.

<br/>

# API

```java
@GetMapping("hello-api")
@ResponseBody
public String helloApi(@RequestParam("name") String name) {
    return "Hello, " + name; // != view ì´ë¦„
}
```
`@RequestBody`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

- í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì´ ì—†ìœ¼ë©´ `ViewResolver`ë¥¼ ê±°ì¹œë‹¤.
- `@ResponseBody`ë¥¼ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë°˜í™˜ê°’ì„ HTTP ì‘ë‹µ ë³¸ë¬¸ì— ì§ì ‘ ë„£ì–´ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
  - ê°ì²´ ë°˜í™˜ â†’ JSONìœ¼ë¡œ ë³€í™˜ 

### How to serve

1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ì›¹ ì„œë²„ë¡œ ì „ë‹¬ëœë‹¤.
2. ì›¹ ì„œë²„ëŠ” `DispatcherServlet`ì— ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
   `DispatcherServlet`ì€ ì ì ˆí•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ê¸° ìœ„í•´ `HandlerMapping`ì— ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
3. `HandlerMapping`ì€ ìš”ì²­ëœ URLì— ë§¤í•‘ëœ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ì•„ `DispatcherServlet`ì— ì „ë‹¬í•œë‹¤.
4. `DispatcherServlet`ì€ `HandlerAdapter`ë¥¼ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•œë‹¤.
5. ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.
6. `HttpMessageConverter`ëŠ” ê²°ê³¼ê°€ ì ì ˆí•œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œë‹¤.
  - ë¬¸ìì—´ â†’ `StringConverter`
  - ê°ì²´ â†’ `JsonConverter`
7. `DispatcherServlet`ì€ ìµœì¢… ì‘ë‹µì„ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•œë‹¤.